@model MyPortal.ViewModels.NewProductViewModel
@{
    ViewBag.Title = "NewProduct";
    Layout = "~/Views/Shared/_LayoutFinance.cshtml";
}

<h2>New Product</h2>
<hr/>
<body>
@using (Ajax.BeginForm(null, null, new AjaxOptions {Url = ""}, new {id = "newProductForm"}))
{
    <div class="form-group">
        @Html.LabelFor(x => x.Product.Description)
        @Html.TextBoxFor(x => x.Product.Description, new {@class = "form-control", Name = "Description"})
        @Html.ValidationMessageFor(x => x.Product.Description)
    </div>
    <div class="form-group">
        @Html.LabelFor(x => x.Product.Price)
        <div class="input-group">
            <span class="input-group-addon" id="basic-addon" style="font-weight: bold;">£</span>
            @Html.TextBoxFor(x => x.Product.Price, new {@class = "form-control", Name = "Price"})
        </div>
        @Html.ValidationMessageFor(x => x.Product.Price)
    </div>
    <div class="checkbox">
        <label style="font-weight: bold;">
            @Html.CheckBoxFor(x => x.Product.Visible, new {Name = "Visible"}) Available on Store
        </label>
    </div>
    <div class="checkbox">
        <label style="font-weight: bold;">
            @Html.CheckBoxFor(x => x.Product.OnceOnly, new {Name = "OnceOnly"}) One-Time Purchase
        </label>
    </div>
    <button type="button" class="btn btn-primary" id="backButton">Back</button>
    <button type="submit" class="btn btn-primary">Save</button>
}
<br/>
</body>

@section scripts
{
    <script>
        $(document).ready(function() {
            $("#newProductForm").on("submit",
                function(e) {

                    e.preventDefault();

                    var form = $("#newProductForm");
                    var data = form.serialize();

                    $.ajax({
                        url: "/api/products/new",
                        data: data,
                        method: "POST",
                        success: function(result) {
                            toastr.success(result);
                            location.replace("/Staff/Finance/Products");
                        },
                        error: function(result) {
                            toastr.error(result.responseJSON);
                            form.reset();
                        }
                    });
                });

            $("#backButton").on("click",
                function() {
                    location.replace("/Staff/Finance/Products");
                });
        })
    </script>

    @Scripts.Render("~/bundles/jqueryval")
}